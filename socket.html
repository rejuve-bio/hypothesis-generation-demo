<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask WebSocket Listener</title>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Listening to WebSocket Messages</h1>
    <div id="messages"></div>

    <script>
        // Connect to the Flask WebSocket server
        var socket = io('http://100.67.47.42:5003');  // Change the URL if needed

        // Listen for incoming messages
        socket.on('connect', function() {
            console.log('Connected to WebSocket server');
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from WebSocket server');
        });

        // Handle messages from the server
        socket.on('task_update', function(data) {
    console.log('Received message: ', data);
    var messageDiv = document.getElementById('messages');
    
    // Check if the message is an object
    if (data.message && typeof data.message === 'object') {
        const firstKey = Object.keys(data.message)[0];  // Get the first key of the message
        
        if (firstKey === 'Executing') {
            messageDiv.innerHTML += '<p>' + 'Executing:  ' + data.message['Executing'] + 
                (data.message['Next_task'] ? ' Next Task:  ' + data.message['Next_task'] : '') + 
                '</p>';
        } else if (firstKey === 'Finished') {
            messageDiv.innerHTML += '<p>' + 'Finished:  ' + data.message['Finished'] + '</p>';
        } else if (firstKey === 'Failed') {
            messageDiv.innerHTML += '<p>' + 'Failed: ' + data.message['Failed'] + 
                (data.message['Next_task'] ? ' Next Task: ' + data.message['Next_task'] : '') + 
                (data.message['error'] ? ' Error: ' + data.message['error'] : '') + 
                '</p>';
        } else {
            // Handle cases where the first key is not one of the expected values
            messageDiv.innerHTML += '<p>' + 'Unknown state: ' + JSON.stringify(data.message) + '</p>';
        }
    } else {
        // Handle non-object messages
        messageDiv.innerHTML += '<p>' + data.message + '</p>';
    }
});

    </script>
</body>
</html>
